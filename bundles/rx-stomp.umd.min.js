!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("rxjs"),require("rxjs/operators"),require("@stomp/stompjs")):"function"==typeof define&&define.amd?define("RxStomp",["rxjs","rxjs/operators","@stomp/stompjs"],t):"object"==typeof exports?exports.RxStomp=t(require("rxjs"),require("rxjs/operators"),require("@stomp/stompjs")):e.RxStomp=t(e.rxjs,e.rxjs.operators,e.StompJs)}("undefined"!=typeof self?self:this,(function(e,t,n){return function(e){var t={};function n(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(s,o,function(t){return e[t]}.bind(null,o));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.CONNECTING=0]="CONNECTING",e[e.OPEN=1]="OPEN",e[e.CLOSING=2]="CLOSING",e[e.CLOSED=3]="CLOSED"}(t.RxStompState||(t.RxStompState={}))},function(e,t,n){e.exports=n(4)},function(e,t,n){"use strict";function s(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),s(n(5)),s(n(6)),s(n(2)),s(n(8)),s(n(9))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.RxStompConfig=class{}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0),o=n(1),r=n(7),i=n(2);t.RxStomp=class{constructor(){this._queuedMessages=[],this._stompClient=new r.Client;const e=()=>{};this._beforeConnect=e,this._debug=e,this._connectionStatePre$=new s.BehaviorSubject(i.RxStompState.CLOSED),this._connectedPre$=this._connectionStatePre$.pipe(o.filter(e=>e===i.RxStompState.OPEN)),this.connectionState$=new s.BehaviorSubject(i.RxStompState.CLOSED),this.connected$=this.connectionState$.pipe(o.filter(e=>e===i.RxStompState.OPEN)),this.connected$.subscribe(()=>{this._sendQueuedMessages()}),this._serverHeadersBehaviourSubject$=new s.BehaviorSubject(null),this.serverHeaders$=this._serverHeadersBehaviourSubject$.pipe(o.filter(e=>null!==e)),this.stompErrors$=new s.Subject,this.unhandledMessage$=new s.Subject,this.unhandledReceipts$=new s.Subject,this.unhandledFrame$=new s.Subject,this.webSocketErrors$=new s.Subject}get stompClient(){return this._stompClient}configure(e){const t=Object.assign({},e);t.beforeConnect&&(this._beforeConnect=t.beforeConnect,delete t.beforeConnect),this._stompClient.configure(t),t.debug&&(this._debug=t.debug)}activate(){this._stompClient.configure({beforeConnect:async()=>{this._changeState(i.RxStompState.CONNECTING),await this._beforeConnect(this)},onConnect:e=>{this._serverHeadersBehaviourSubject$.next(e.headers),this._changeState(i.RxStompState.OPEN)},onStompError:e=>{this.stompErrors$.next(e)},onWebSocketClose:()=>{this._changeState(i.RxStompState.CLOSED)},onUnhandledMessage:e=>{this.unhandledMessage$.next(e)},onUnhandledReceipt:e=>{this.unhandledReceipts$.next(e)},onUnhandledFrame:e=>{this.unhandledFrame$.next(e)},onWebSocketError:e=>{this.webSocketErrors$.next(e)}}),this._stompClient.activate()}deactivate(){this._stompClient.deactivate();const e=this.connectionState$.getValue();e===i.RxStompState.OPEN&&this._changeState(i.RxStompState.CLOSING),e===i.RxStompState.CONNECTING&&this._changeState(i.RxStompState.CLOSED)}connected(){return this.connectionState$.getValue()===i.RxStompState.OPEN}get active(){return this.stompClient.active}publish(e){const t=null==e.retryIfDisconnected||e.retryIfDisconnected;if(this.connected())this._stompClient.publish(e);else{if(!t)throw new Error("Cannot publish while broker is not connected");this._debug("Not connected, queueing"),this._queuedMessages.push(e)}}_sendQueuedMessages(){const e=this._queuedMessages;if(this._queuedMessages=[],0!==e.length){this._debug(`Will try sending  ${e.length} queued message(s)`);for(const t of e)this._debug("Attempting to send "+t),this.publish(t)}}watch(e,t={}){this._debug("Request to subscribe "+e),t.ack||(t.ack="auto");return s.Observable.create(n=>{let s,o;return o=this._connectedPre$.subscribe(()=>{this._debug("Will subscribe to "+e),s=this._stompClient.subscribe(e,e=>{n.next(e)},t)}),()=>{this._debug(`Stop watching connection state (for ${e})`),o.unsubscribe(),this.connected()?(this._debug(`Will unsubscribe from ${e} at Stomp`),s.unsubscribe()):this._debug(`Stomp not connected, no need to unsubscribe from ${e} at Stomp`)}}).pipe(o.share())}watchForReceipt(e,t){this._stompClient.watchForReceipt(e,t)}_changeState(e){this._connectionStatePre$.next(e),this.connectionState$.next(e)}}},function(e,t){e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.RxStompRPCConfig=class{}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0),o=n(1),r=n(10);t.RxStompRPC=class{constructor(e,t){this.rxStomp=e,this.stompRPCConfig=t,this._replyQueueName="/temp-queue/rpc-replies",this._setupReplyQueue=()=>this.rxStomp.unhandledMessage$,t&&(t.replyQueueName&&(this._replyQueueName=t.replyQueueName),t.setupReplyQueue&&(this._setupReplyQueue=t.setupReplyQueue))}rpc(e){return this.stream(e).pipe(o.first())}stream(e){const t=Object.assign({},e.headers||{}),{destination:n,body:i,binaryBody:u}=e;return this._repliesObservable||(this._repliesObservable=this._setupReplyQueue(this._replyQueueName,this.rxStomp)),s.Observable.create(e=>{let s;const c=t["correlation-id"]||r.UUID.UUID();return s=this._repliesObservable.pipe(o.filter(e=>e.headers["correlation-id"]===c)).subscribe(t=>{e.next(t)}),t["reply-to"]=this._replyQueueName,t["correlation-id"]=c,this.rxStomp.publish({destination:n,body:i,binaryBody:u,headers:t}),()=>{s.unsubscribe()}})}}},function(e,t,n){"use strict";var s=function(){function e(){}return e.UUID=function(){if("undefined"!=typeof window&&void 0!==window.crypto&&void 0!==window.crypto.getRandomValues){var e=new Uint16Array(8);return window.crypto.getRandomValues(e),this.pad4(e[0])+this.pad4(e[1])+"-"+this.pad4(e[2])+"-"+this.pad4(e[3])+"-"+this.pad4(e[4])+"-"+this.pad4(e[5])+this.pad4(e[6])+this.pad4(e[7])}return this.random4()+this.random4()+"-"+this.random4()+"-"+this.random4()+"-"+this.random4()+"-"+this.random4()+this.random4()+this.random4()},e.pad4=function(e){for(var t=e.toString(16);t.length<4;)t="0"+t;return t},e.random4=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},e}();t.UUID=s}])}));
//# sourceMappingURL=rx-stomp.umd.min.js.map